name: Locally Contract Deploy
description: Runs a Hardhat node & deploys contracts

runs:
  using: composite
  steps:
    - working-directory: ./
      shell: bash
      run: docker-compose up -d postgres

    - working-directory: ./aggregator
      shell: bash
      run: cp .env.local.example .env

    # wait 10 seconds to allow the aggregator to spin up
    - working-directory: ./aggregator
      shell: bash
      run: |
        deno run --allow-read --allow-env --allow-net ./programs/aggregator.ts &
        sleep 10
